<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>KavyaShift – Team Leader</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- FontAwesome -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
    body { font-family: "Poppins", sans-serif; background: #f9fbff; }
    .sidebar { background: #1d284c; color: #fff; height: 100vh; padding-top: 30px; }
    .sidebar .logo img { width: 160px; }
    .sidebar .menu { margin-top: 50px; }
    .sidebar .menu-item { display: block; padding: 10px 20px; margin-bottom: 5px; color: #fff; border: none; width: 100%; text-align: left; cursor: pointer; background: none; }
    .sidebar .menu-item.active { background: #19c37d; border-radius: 5px; }
    .sidebar .settings { position: absolute; bottom: 20px; padding: 10px 20px; cursor: pointer; }
    .table-wrapper { background: #fff; border-radius: 10px; padding: 20px; margin: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    .tl-row { cursor: pointer; }
    .employee-list { display: none; margin-top: 5px; }
    .employee-item { padding: 5px 10px; border-bottom: 1px solid #eee; }
</style>
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-2 sidebar">
            <div class="logo text-center mb-4">
                <img src="assets/img/kipl.png" alt="logo">
            </div>
            <div class="menu">
                <button class="menu-item" onclick="window.location.href='admin.html'">
                    <i class="fa-regular fa-circle-dot me-2"></i>Dashboard
                </button>
                <button class="menu-item active" onclick="window.location.href='teamleader.html'">
                    <i class="fa-regular fa-file me-2"></i>Team Leader
                </button>
                <button class="menu-item" onclick="window.location.href='archive.html'">
                    <i class="fa-regular fa-folder me-2"></i>History
                </button>
            </div>
            <div class="settings" onclick="openSettings()">
                <i class="fa-solid fa-gear me-2"></i> Settings
            </div>
        </div>

        <!-- Main content -->
        <div class="col-10">
            <h3 class="mt-4 ms-4 fw-bold">Team Leader – Employees Overview</h3>
            <h5 class="ms-4" id="tlName"></h5>

            <div class="table-wrapper">
                <table class="table table-bordered" id="tlTable">
                    <thead>
                        <tr>
                            <th>Employee Name</th>
                            <th>Login</th>
                            <th>Logout</th>
                            <th>Duration</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Rows will be populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", async function() {
    const token = localStorage.getItem("token");
    const fullName = localStorage.getItem("fullName");
    const role = localStorage.getItem("role");
    const email = localStorage.getItem("email");

    // Redirect if unauthorized
    if (!token || role !== "TEAM_LEADER" && role !== "TL") {
        alert("Unauthorized access! Please login.");
        window.location.href = "index.html";
        return;
    }

    // Show TL name
    document.getElementById("tlName").innerText = "Logged in as: " + fullName;

    // Fetch TL employees
    async function fetchEmployees() {
        try {
            const response = await fetch(`http://localhost:8080/api/tl/employees?email=${encodeURIComponent(email)}`, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + token
                }
            });

            if (!response.ok) throw new Error("Failed to fetch employees");

            const data = await response.json();
            return data; // array of employees
        } catch (err) {
            console.error(err);
            alert("Error fetching employees");
            return [];
        }
    }

    function renderTable(employees) {
        const tbody = document.querySelector("#tlTable tbody");
        tbody.innerHTML = "";

        if (employees.length === 0) {
            tbody.innerHTML = `<tr><td colspan="5" class="text-center">No employees found</td></tr>`;
            return;
        }

        employees.forEach(emp => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${emp.fullName}</td>
                <td>${emp.login || "N/A"}</td>
                <td>${emp.logout || "N/A"}</td>
                <td>${emp.duration || "N/A"}</td>
                <td>${emp.status || "Pending"}</td>
            `;
            tbody.appendChild(tr);
        });
    }

    const employees = await fetchEmployees();
    renderTable(employees);
});

// Open settings
function openSettings() {
    window.location.href = "settings.html";
}
</script>

</body>
</html>
